<!DOCTYPE html>
<html lang="en"> <!--Presentation at 3:40-->

    <head>
        
        
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.2/animate.min.css">
        <link href="https://fonts.googleapis.com/css?family=Nunito&display=swap" rel="stylesheet">

        <link href="https://fonts.googleapis.com/css?family=Nunito:200,300,400,600,700,800,900&display=swap"
              rel="stylesheet">
        
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

        <style>
            * {
                margin: 0;
                padding: 0;
                -webkit-box-sizing: border-box;
                box-sizing: border-box;
                line-height: normal;
                text-align: center;
            }

            body {
                background-color: #FFFFFF;
                text-color: black;
            }

            section {
                padding: 35px 0;
            }

            .rolling-trans {
                border-right: 1px solid #8e8e8e;
            }


            .meeting-agenda {
                height: 200px;
                background-color: #c9c8c8;
                width: 550px;
                display: block;
                margin: 30px auto;
                border-radius: 15px;
                border-color: #c9c8c8;
            }

            .text-summary {
                text-align: left;
                margin-top: 20px;
                margin-right: 10px;
                margin-left: 10px;
            }

            .custom-card {
                margin-top: 30px;
                padding: 0 20px;
                overflow: auto;
            }

            .custom-textarea {
                height: 230px !important;
            }

            .meeting-cards {
                height: 500px;
                overflow-y: auto;
            }

            .title-cus {
                margin-bottom: 20px;
            }

            .nfont {
                font-family: 'Nunito', sans-serif;
                font-weight: 200;
                color: black;
            }

            .titling {
                letter-spacing: 2px;
                font-size: 32px;
            }


            .gradient-45deg-light-blue-teal {
                background: -webkit-linear-gradient(45deg, #4dd0e1 0%, #ffecb3 100%);
                background: linear-gradient(45deg, #4dd0e1 0%, #ffecb3 100%);
            }
            .gradient-45deg-light-blue-teal.gradient-shadow {
                box-shadow: 0 6px 20px 0 rgba(100, 255, 218, 0.5);
            }
            .gradient-45deg-reverse {
                background: -webkit-linear-gradient(45deg, #26c6da 0%, #fffde7 170%);
                background: linear-gradient(45deg, #26c6da 0%, #fffde7 170%);
            }
            .gradient-45deg-reverse.gradient-shadow {
                box-shadow: 0 6px 20px 0 rgba(100, 255, 218, 0.5);
            }
            .gradient-45deg-green {
                background: -webkit-linear-gradient(45deg, #00e676 0%, #1de9b6 170%);
                background: linear-gradient(45deg, #00e676 0%, #1de9b6 170%);
            }
            .gradient-45deg-green.gradient-shadow {
                box-shadow: 0 6px 20px 0 rgba(100, 255, 218, 0.5);
            }
            .gradient-45deg-red {
                background: -webkit-linear-gradient(45deg, #e91e63 0%, #1de9b6 170%);
                background: linear-gradient(45deg, #e91e63 0%, #1de9b6 170%);
            }
            .gradient-45deg-red.gradient-shadow {
                box-shadow: 0 6px 20px 0 rgba(100, 255, 218, 0.5);
            }
        </style>

    </head>
    
    
    <script>
       
    </script>
    <body>
    <div class="container">
        <section id="rolling-transcription">
           <div class="row">
                <div class="col s5 push-s7 ">

                    <p class="center nfont titling">agenda <i class="material-icons" style="font-size: 36px; color: black;">dashboard</i></p>

                    <div class="row">
                        <form class="col s12">
                          <div class="row">
                            <div class="input-field col s12">
                              <textarea id="textarea1" class="custom-textarea materialize-textarea"></textarea>
                              <label for="textarea1">Textarea</label>
                            </div>
                          </div>
                        </form>
                      </div>

                    <p class="center nfont titling">summary <i class="material-icons" style="font-size: 36px; color: black;">track_changes</i></p>
                    <p class="text-summary nfont" id="meeting-summary">Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and more recently with desktop publishing software like Aldus PageMaker including versions of Lorem Ipsum.</p>
                    </div>
                <div class="col s7 pull-s5 rolling-trans">

                    <p class="center nfont titling">chat <i class="material-icons" style="font-size: 36px; color: black;">chat</i></p>

                    <div class="card gradient-shadow gradient-45deg-reverse z-depth-1">
                        <div class="row nunito valign-wrapper">
                            <div class="col s1"></div>
                            <div class="col s1">
                                <img src="https://previews.123rf.com/images/punphoto/punphoto1211/punphoto121100083/16291629-colorful-abstract-water-color-art-hand-paint-background.jpg" class="circle responsive-img">
                            </div>

                            <div class="col s10">
                                <div class="card-content white-text nunito" class="style=">
                                        <b>Devin</b>
                                        <br/>
                                        Yo I am amazing and stuff
                                </div>
                            </div>
                        </div>
                    </div>

                  <div class="meeting-cards nfont" id="meeting-set">

                </div>
               </div>
            </div> 
            
        </section>

    </div>

    <div class="navbar-fixed" style="bottom:0; position:fixed;">
        <nav>
            <div class="nav-wrapper grey ">
                <ul class="left hide-on-med-and-down">
                    <li><a class="waves-effect waves-light" id="mic-button" onclick="toggleMic()"><i class="material-icons">mic_off</i></a></li>

                </ul>
            </div>
        </nav>
    </div>

    </body>
    
    <script type="text/javascript">

        let socket = new WebSocket("ws://localhost:3001/stream-audio");
        // this is great everything is great

        let bufferSize = 2048,
            AudioContext,
            context,
            processor,
            input,
            globalStream;

        let mic = false;
        function toggleMic() {
            if (mic) {
                document.getElementById("mic-button").innerHTML = "<i class=\"material-icons\">mic_off</i>"

                // stop recording
                let track = globalStream.getTracks()[0];
                track.stop();

                input.disconnect(processor);
                processor.disconnect(context.destination);
                context.close().then(function () {
                    input = null;
                    processor = null;
                    context = null;
                    AudioContext = null;
                });

            } else {
                document.getElementById("mic-button").innerHTML = "<i class=\"material-icons\">mic</i>"

                // start recording
                AudioContext = window.AudioContext || window.webkitAudioContext;
                context = new AudioContext({
                    latencyHint: 'interactive',
                });
                processor = context.createScriptProcessor(bufferSize, 1, 1);
                processor.connect(context.destination);
                context.resume();

                let handleSuccess = function (stream) {
                    globalStream = stream;
                    input = context.createMediaStreamSource(stream);
                    input.connect(processor);

                    processor.onaudioprocess = function (e) {
                        microphoneProcess(e);
                    };
                };

                navigator.mediaDevices.getUserMedia({
                    audio: true,
                    video: false
                })
                    .then(handleSuccess);

            }
            mic = !mic;
        }

        function microphoneProcess(e) {
            let left = e.inputBuffer.getChannelData(0);
            let left16 = downsampleBuffer(left, 44100, 16000);
            socket.send(left16);
        }

        let downsampleBuffer = function (buffer, sampleRate, outSampleRate) {
            if (outSampleRate == sampleRate) {
                return buffer;
            }
            if (outSampleRate > sampleRate) {
                throw "downsampling rate show be smaller than original sample rate";
            }
            let sampleRateRatio = sampleRate / outSampleRate;
            let newLength = Math.round(buffer.length / sampleRateRatio);
            let result = new Int16Array(newLength);
            let offsetResult = 0;
            let offsetBuffer = 0;
            while (offsetResult < result.length) {
                let nextOffsetBuffer = Math.round((offsetResult + 1) * sampleRateRatio);
                let accum = 0, count = 0;
                for (let i = offsetBuffer; i < nextOffsetBuffer && i < buffer.length; i++) {
                    accum += buffer[i];
                    count++;
                }

                result[offsetResult] = Math.min(1, accum / count) * 0x7FFF;
                offsetResult++;
                offsetBuffer = nextOffsetBuffer;
            }
            return result.buffer;
        };

        // ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

        function httpGet(theUrl) {
            var xmlHttp = new XMLHttpRequest();
            xmlHttp.open("GET", theUrl, false); // false for synchronous request
            xmlHttp.send(null);
            return xmlHttp.responseText;
        }
        
        var time = 0;
        var time2 = 0;
        var interval = setInterval(function() { 
              time+=2;
              console.log(time);
              document.getElementById("meeting-summary").textContent = httpGet('/live-summary')
            
        }, 2000);
        
        var interval = setInterval(function() { 
              time2+=2;
              console.log(time2);
              document.getElementById("meeting-set").innerHTML = httpGet('/live-chat')
            
        }, 2000);
        
        
    </script>
</html>


            